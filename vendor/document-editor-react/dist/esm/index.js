import e,{useEffect as n}from"react";function o(e,n,o,t){return new(o||(o=Promise))((function(i,s){function r(e){try{c(t.next(e))}catch(e){s(e)}}function d(e){try{c(t.throw(e))}catch(e){s(e)}}function c(e){let n;e.done?i(e.value):(n=e.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,d)}c((t=t.apply(e,n||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;const t=(e,n,o,t)=>{const i=document.createElement("script");return i.id=e,i.type="text/javascript",i.src=n,i.async=!0,i.onload=()=>{i.removeAttribute("loading"),o(null)},i.onerror=e=>{i.removeAttribute("loading"),t(e)},i.setAttribute("loading",""),i},i=i=>{const{id:s,documentServerUrl:r,config:d,document_fileType:c,document_title:a,documentType:u,editorConfig_lang:l,height:v,type:w,width:p,onLoadComponentError:m,events_onAppReady:R,events_onDocumentStateChange:g,events_onMetaChange:y,events_onDocumentReady:f,events_onInfo:h,events_onWarning:E,events_onError:D,events_onRequestSharingSettings:q,events_onRequestRename:_,events_onMakeActionLink:S,events_onRequestInsertImage:I,events_onRequestSaveAs:A,events_onRequestMailMergeRecipients:C,events_onRequestCompareFile:b,events_onRequestEditRights:k,events_onRequestHistory:M,events_onRequestHistoryClose:P,events_onRequestHistoryData:H,events_onRequestRestore:x,events_onRequestSelectSpreadsheet:L,events_onRequestSelectDocument:O,events_onOutdatedVersion:T}=i;n((()=>{let e;(null===(e=null===window||void 0===window?void 0:window.DocEditor)||void 0===e?void 0:e.instances[s])&&(window.DocEditor.instances[s].destroyEditor(),window.DocEditor.instances[s]=void 0,console.log("Important props have been changed. Load new Editor."),j())}),[r,JSON.stringify(d),c,a,u,l,v,w,p]),n((()=>{let e=r;return e.endsWith("/")||(e+="/"),((e,n)=>o(void 0,void 0,void 0,(function*(){return new Promise(((o,i)=>{try{if(window.DocsAPI)return o(null);const s=document.getElementById(n);if(s){const r=setInterval((()=>{if(!s.getAttribute("loading")){if(clearInterval(r),window.DocsAPI)return o(null);const d=t(n,e,o,i);s.remove(),document.body.appendChild(d)}}),500)}else{const s=t(n,e,o,i);document.body.appendChild(s)}}catch(e){console.error(e)}}))})))(`${e}web-apps/apps/api/documents/api.js`,"onlyoffice-api-script").then((()=>j())).catch((()=>W(-2))),()=>{let e;(null===(e=null===window||void 0===window?void 0:window.DocEditor)||void 0===e?void 0:e.instances[s])&&(window.DocEditor.instances[s].destroyEditor(),window.DocEditor.instances[s]=void 0)}}),[]);const j=()=>{let e,n;try{if(window.DocsAPI||W(-3),null===(e=null===window||void 0===window?void 0:window.DocEditor)||void 0===e?void 0:e.instances[s])return void console.log("Skip loading. Instance already exists",s);(null===(n=null===window||void 0===window?void 0:window.DocEditor)||void 0===n?void 0:n.instances)||(window.DocEditor={instances:{}});const o=Object.assign({document:{fileType:c,title:a},documentType:u,editorConfig:{lang:l},events:{onAppReady:F,onDocumentStateChange:g,onMetaChange:y,onDocumentReady:f,onInfo:h,onWarning:E,onError:D,onRequestSharingSettings:q,onRequestRename:_,onMakeActionLink:S,onRequestInsertImage:I,onRequestSaveAs:A,onRequestMailMergeRecipients:C,onRequestCompareFile:b,onRequestEditRights:k,onRequestHistory:M,onRequestHistoryClose:P,onRequestHistoryData:H,onRequestRestore:x,onRequestSelectSpreadsheet:L,onRequestSelectDocument:O,onOutdatedVersion:T},height:v,type:w,width:p},d||{}),t=window.DocsAPI.DocEditor(s,o);window.DocEditor.instances[s]=t}catch(e){console.error(e),W(-1)}},W=e=>{let n;switch(e){case-2:n="Error load DocsAPI from "+r;break;case-3:n="DocsAPI is not defined";break;default:n="Unknown error loading component",e=-1}void 0===m?console.error(n):m(e,n)},F=()=>{R(window.DocEditor.instances[s])};return e.createElement("div",{id:s})};export{i as DocumentEditor};